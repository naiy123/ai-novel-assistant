# ğŸš€ æœåŠ¡å™¨éƒ¨ç½²æ£€æŸ¥æ¸…å•

## âœ¨ é‡è¦æ›´æ–°

### ğŸŸ¢ å·²å‡çº§åˆ°SQLiteæ•°æ®åº“ï¼

**æ”¹è¿›ï¼š**
- âœ… æ•°æ®æŒä¹…åŒ–ï¼šæœåŠ¡å™¨é‡å¯åæ•°æ®ä¸ä¼šä¸¢å¤±
- âœ… è‡ªåŠ¨åˆå§‹åŒ–ï¼šé¦–æ¬¡å¯åŠ¨è‡ªåŠ¨åˆ›å»ºè¡¨ç»“æ„
- âœ… æ— éœ€é¢å¤–é…ç½®ï¼šSQLiteæ˜¯æ–‡ä»¶æ•°æ®åº“ï¼Œå¼€ç®±å³ç”¨
- âœ… åŒ…å«ç¤ºä¾‹æ•°æ®ï¼šæµ‹è¯•ç”¨æˆ·å’Œç¤ºä¾‹å¡ç‰‡

### ğŸŒ æ”¯æŒNginxåå‘ä»£ç†

**ä¼˜åŠ¿ï¼š**
- âœ… å‰åç«¯ç»Ÿä¸€åŸŸå
- âœ… æ›´å¥½çš„æ€§èƒ½
- âœ… æ”¯æŒHTTPS
- âœ… æ— CORSé—®é¢˜

---

## ğŸ“‹ éƒ¨ç½²å‰å‡†å¤‡

### 1. æ¨é€ä»£ç 
```bash
# æäº¤å½“å‰ä¿®æ”¹
git add .
git commit -m "ä¼˜åŒ–AIå†™ä½œç•Œé¢ï¼šè°ƒæ•´å­—æ•°é€‰é¡¹ï¼Œæ”¹ä¸ºå¡ç‰‡é€‰æ‹©å¼¹çª—"
git push
```

### 2. æœåŠ¡å™¨ä¸Šæ‹‰å–ä»£ç 
```bash
cd /ä½ çš„æœåŠ¡å™¨è·¯å¾„/ai-novel-assistant
git pull
```

---

## âš™ï¸ æœåŠ¡å™¨é…ç½®ï¼ˆæ‰‹åŠ¨ï¼‰

### 1. åˆ›å»ºåç«¯ç¯å¢ƒé…ç½®
```bash
cd backend
nano .env
```

å¤åˆ¶ä»¥ä¸‹å†…å®¹ï¼ˆä¿®æ”¹ä¸ºä½ çš„é…ç½®ï¼‰ï¼š
```env
PORT=5000
NODE_ENV=production
JWT_SECRET=ä¿®æ”¹ä¸ºä½ çš„éšæœºå¯†é’¥-è‡³å°‘32ä½å­—ç¬¦
VERTEX_AI_PROJECT_ID=ä½ çš„Googleé¡¹ç›®ID
VERTEX_AI_LOCATION=us-central1
GOOGLE_APPLICATION_CREDENTIALS=./credentials/google-cloud-key.json
CORS_ORIGIN=*
```

### 2. ä¸Šä¼ Google Cloudå¯†é’¥
```bash
# æ–¹æ³•1ï¼šä½¿ç”¨SCP
scp æœ¬åœ°/google-cloud-key.json ç”¨æˆ·@æœåŠ¡å™¨:/è·¯å¾„/backend/credentials/

# æ–¹æ³•2ï¼šåœ¨æœåŠ¡å™¨ä¸Šåˆ›å»º
cd backend/credentials
nano google-cloud-key.json
# ç²˜è´´å¯†é’¥å†…å®¹
```

### 3. å®‰è£…ä¾èµ–
```bash
# åç«¯ä¾èµ–ï¼ˆåŒ…å«æ–°çš„better-sqlite3ï¼‰
cd backend
npm install

# å‰ç«¯ä¾èµ–
cd ../frontend
npm install
```

### 4. æ„å»ºå‰ç«¯
```bash
cd frontend
npm run build
```

### 5. æ•°æ®åº“åˆå§‹åŒ–

SQLiteä¼šåœ¨é¦–æ¬¡å¯åŠ¨æ—¶è‡ªåŠ¨åˆå§‹åŒ–ï¼š
- âœ… åˆ›å»º `backend/database/novel.db` æ–‡ä»¶
- âœ… åˆ›å»ºæ‰€æœ‰è¡¨ç»“æ„
- âœ… åˆ›å»ºæµ‹è¯•ç”¨æˆ·ï¼ˆtest/123456ï¼‰
- âœ… åˆ›å»ºç¤ºä¾‹å¡ç‰‡

---

## ğŸš€ å¯åŠ¨æœåŠ¡

### æ–¹æ³•1ï¼šä½¿ç”¨PM2é…ç½®æ–‡ä»¶ï¼ˆæ¨èï¼‰
```bash
# åœ¨é¡¹ç›®æ ¹ç›®å½•
pm2 start ecosystem.config.js
pm2 save
pm2 startup
```

### æ–¹æ³•2ï¼šæ‰‹åŠ¨å¯åŠ¨
```bash
# åç«¯
cd backend
pm2 start server.js --name "ai-novel-backend"

# å‰ç«¯
cd frontend
pm2 serve dist 3000 --name "ai-novel-frontend" --spa
```

### æ–¹æ³•3ï¼šä½¿ç”¨Nginxï¼ˆæ¨èç”Ÿäº§ç¯å¢ƒï¼‰â­

**ä¼˜åŠ¿**ï¼šå‰åç«¯ç»Ÿä¸€åŸŸåï¼Œæ›´ä¸“ä¸š

```bash
# 1. å¤åˆ¶é…ç½®æ–‡ä»¶
sudo cp nginx/ai-novel-assistant.conf /etc/nginx/sites-available/ai-novel-assistant

# 2. ç¼–è¾‘é…ç½®
sudo nano /etc/nginx/sites-available/ai-novel-assistant
# ä¿®æ”¹ï¼šserver_name å’Œ root è·¯å¾„

# 3. å¯ç”¨é…ç½®
sudo ln -s /etc/nginx/sites-available/ai-novel-assistant /etc/nginx/sites-enabled/

# 4. æµ‹è¯•å¹¶é‡å¯
sudo nginx -t
sudo systemctl reload nginx

# 5. å¯åŠ¨åç«¯ï¼ˆå‰ç«¯ç”±Nginxæä¾›ï¼‰
cd backend
pm2 start server.js --name "ai-novel-backend"
pm2 save
```

**è®¿é—®**: `http://ä½ çš„åŸŸå` æˆ– `http://ä½ çš„IP`

---

## ğŸ” éƒ¨ç½²åæ£€æŸ¥

### 1. æ£€æŸ¥æœåŠ¡çŠ¶æ€
```bash
pm2 status
pm2 logs
```

### 2. æ£€æŸ¥ç«¯å£ç›‘å¬
```bash
# Linux
netstat -tlnp | grep -E ":(3000|5000)"

# Windows
netstat -ano | Select-String ":(3000|5000)"
```

### 3. æµ‹è¯•API
```bash
# æµ‹è¯•åç«¯
curl http://localhost:5000/api/health

# æˆ–
curl http://ä½ çš„æœåŠ¡å™¨IP:5000/api/health
```

### 4. è®¿é—®å‰ç«¯
```
http://ä½ çš„æœåŠ¡å™¨IP:3000
```

---

## ğŸ†˜ å¸¸è§é—®é¢˜

### Q1: æ¨é€åå‰ç«¯æ²¡æœ‰æ›´æ–°
**åŸå› **ï¼šå‰ç«¯éœ€è¦é‡æ–°æ„å»º

**è§£å†³**ï¼š
```bash
cd frontend
npm run build
pm2 restart ai-novel-frontend
```

### Q2: APIè¯·æ±‚å¤±è´¥
**åŸå› 1**ï¼šåç«¯æœªå¯åŠ¨æˆ–ç«¯å£ä¸å¯¹

**æ£€æŸ¥**ï¼š
```bash
pm2 status
pm2 logs ai-novel-backend
```

**åŸå› 2**ï¼šCORSé…ç½®é—®é¢˜

**è§£å†³**ï¼šç¡®ä¿ `backend/.env` ä¸­ `CORS_ORIGIN=*`

### Q3: Google APIè°ƒç”¨å¤±è´¥
**åŸå› **ï¼šå¯†é’¥æ–‡ä»¶è·¯å¾„é”™è¯¯æˆ–æƒé™é—®é¢˜

**æ£€æŸ¥**ï¼š
```bash
# æ£€æŸ¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨
ls -la backend/credentials/google-cloud-key.json

# æ£€æŸ¥ç¯å¢ƒå˜é‡
pm2 env ai-novel-backend | grep GOOGLE
```

### Q4: å¦‚ä½•å¤‡ä»½æ•°æ®åº“
**SQLiteå¤‡ä»½å¾ˆç®€å•**ï¼š

```bash
# å¤‡ä»½æ•°æ®åº“
cp backend/database/novel.db backend/database/novel.db.backup

# æ¢å¤æ•°æ®åº“
pm2 stop all
cp backend/database/novel.db.backup backend/database/novel.db
pm2 start all
```

---

## ğŸ”§ Nginxé…ç½®ï¼ˆå¯é€‰ï¼Œæ¨èï¼‰

å¦‚æœä½¿ç”¨Nginxä½œä¸ºåå‘ä»£ç†ï¼š

```nginx
server {
    listen 80;
    server_name ä½ çš„åŸŸåæˆ–IP;

    # å‰ç«¯é™æ€æ–‡ä»¶
    location / {
        root /è·¯å¾„/ai-novel-assistant/frontend/dist;
        try_files $uri $uri/ /index.html;
    }

    # åç«¯APIä»£ç†
    location /api {
        proxy_pass http://localhost:5000;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_cache_bypass $http_upgrade;
    }
}
```

é…ç½®åï¼š
```bash
sudo nginx -t
sudo systemctl reload nginx
```

è¿™æ ·å¯ä»¥é€šè¿‡ `http://ä½ çš„åŸŸå` ç›´æ¥è®¿é—®ï¼Œä¸éœ€è¦ç«¯å£å·ã€‚

---

## ğŸ“Š ç›‘æ§å’Œç»´æŠ¤

### æŸ¥çœ‹æ—¥å¿—
```bash
# å®æ—¶æ—¥å¿—
pm2 logs

# æŸ¥çœ‹ç‰¹å®šåº”ç”¨
pm2 logs ai-novel-backend
pm2 logs ai-novel-frontend

# æŸ¥çœ‹é”™è¯¯æ—¥å¿—
pm2 logs --err
```

### é‡å¯æœåŠ¡
```bash
# é‡å¯æ‰€æœ‰
pm2 restart all

# é‡å¯ç‰¹å®šæœåŠ¡
pm2 restart ai-novel-backend
pm2 restart ai-novel-frontend
```

### æ¸…ç©ºæ—¥å¿—
```bash
pm2 flush
```

---

## âš¡ å¿«é€Ÿéƒ¨ç½²å‘½ä»¤ï¼ˆå¤åˆ¶ä½¿ç”¨ï¼‰

```bash
# 1. æ‹‰å–ä»£ç 
git pull

# 2. å®‰è£…ä¾èµ–ï¼ˆå¦‚æœpackage.jsonæœ‰æ›´æ–°ï¼‰
cd backend && npm install && cd ..
cd frontend && npm install && cd ..

# 3. æ„å»ºå‰ç«¯
cd frontend && npm run build && cd ..

# 4. é‡å¯æœåŠ¡
pm2 restart all

# 5. æŸ¥çœ‹çŠ¶æ€
pm2 status && pm2 logs --lines 20
```

---

## ğŸ¯ å…³é”®æ³¨æ„äº‹é¡¹

1. âš ï¸ **æ•°æ®åº“**ï¼šå½“å‰ä½¿ç”¨å†…å­˜å­˜å‚¨ï¼Œé‡å¯ä¼šä¸¢å¤±æ•°æ®
2. âš ï¸ **ç¯å¢ƒå˜é‡**ï¼š`.env` æ–‡ä»¶ä¸ä¼šè¢«æ¨é€ï¼Œéœ€è¦æ‰‹åŠ¨é…ç½®
3. âš ï¸ **å¯†é’¥æ–‡ä»¶**ï¼šGoogle Cloudå¯†é’¥éœ€è¦æ‰‹åŠ¨ä¸Šä¼ 
4. âš ï¸ **å‰ç«¯æ„å»º**ï¼šæ¯æ¬¡å‰ç«¯ä»£ç æ›´æ–°åéƒ½è¦é‡æ–° `npm run build`
5. âš ï¸ **ç«¯å£å¼€æ”¾**ï¼šç¡®ä¿æœåŠ¡å™¨é˜²ç«å¢™å¼€æ”¾3000å’Œ5000ç«¯å£

---

**éƒ¨ç½²å®Œæˆåè®°å¾—æµ‹è¯•æ‰€æœ‰åŠŸèƒ½ï¼** âœ…

