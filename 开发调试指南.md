# 🔧 开发调试指南

## ✅ 当前状态

- ✅ 后端服务：运行在 **http://localhost:5000**
- ✅ 前端服务：运行在 **http://localhost:3000**  
- ✅ 浏览器已自动打开

---

## 🌐 访问地址

### 主要访问地址
```
http://localhost:3000
```

### 测试账号
- **用户名**：`test`
- **密码**：`123456`

---

## 📝 功能测试清单

### 1. 登录功能
- [ ] 访问 http://localhost:3000
- [ ] 输入测试账号登录
- [ ] 检查是否成功跳转到首页

### 2. 小说管理
- [ ] 创建新小说（标题、简介）
- [ ] 查看小说列表
- [ ] 编辑小说信息
- [ ] 删除小说

### 3. 章节编辑
- [ ] 创建新章节
- [ ] 编辑章节内容（Markdown）
- [ ] 测试自动保存（3秒）
- [ ] 查看字数统计
- [ ] 章节切换

### 4. AI功能 ⭐
- [ ] 在章节中输入大纲
- [ ] 点击"AI续写"按钮
- [ ] 选择生成字数
- [ ] 等待AI生成
- [ ] 检查生成内容质量

### 5. 卡片系统
- [ ] 创建人物卡（姓名、性格、外貌）
- [ ] 创建物品卡
- [ ] 创建场景卡
- [ ] 在AI生成时使用卡片

---

## 🐛 调试技巧

### 查看后端日志

**方法1：PowerShell**
```powershell
# 查看后端输出
Get-Content .\backend\output.log -Wait
```

**方法2：浏览器开发者工具**
1. 按 `F12` 打开开发者工具
2. 查看 Console 标签（JavaScript错误）
3. 查看 Network 标签（API请求）

### 查看API请求

在浏览器开发者工具的 Network 标签：
- 筛选 XHR/Fetch 类型
- 查看请求URL、状态码、响应内容
- 检查失败的请求

### 常见错误排查

#### 问题1：网页打不开
```powershell
# 检查前端是否运行
netstat -ano | Select-String ":3000"
```

#### 问题2：API请求失败
```powershell
# 检查后端是否运行
netstat -ano | Select-String ":5000"

# 测试后端API
Invoke-RestMethod -Uri "http://localhost:5000/api/auth/login" -Method Post -ContentType "application/json" -Body '{"username":"test","password":"123456"}'
```

#### 问题3：AI生成失败
1. 检查Google Cloud密钥配置
2. 查看后端日志中的错误
3. 测试Google API连接：
```powershell
cd backend
node test-vertex-ai.js
```

---

## 🔄 重启服务

### 停止所有服务
```powershell
# 找到node进程
Get-Process node

# 停止所有node进程（谨慎使用）
Stop-Process -Name node -Force
```

### 重新启动

**方法1：后台启动（推荐）**
```powershell
# 启动后端
Start-Process powershell -ArgumentList "-NoExit", "-Command", "cd '.\backend'; npm start"

# 启动前端
Start-Process powershell -ArgumentList "-NoExit", "-Command", "cd '.\frontend'; npm run dev"
```

**方法2：使用快捷脚本**
```powershell
.\启动服务.ps1
```

---

## 📂 重要文件位置

### 后端
```
backend/
├── server.js           # 入口文件
├── .env               # 环境配置
├── routes/            # API路由
│   ├── auth.js       # 登录注册
│   ├── novels.js     # 小说管理
│   ├── cards.js      # 卡片管理
│   └── ai.js         # AI生成
├── services/
│   └── ai-service.js # AI服务核心
└── database/
    └── memoryDB.js   # 内存数据库
```

### 前端
```
frontend/
├── src/
│   ├── App.jsx           # 主应用
│   ├── main.jsx          # 入口
│   ├── pages/            # 页面组件
│   │   ├── LoginPage.jsx
│   │   ├── HomePage.jsx
│   │   ├── NovelsPage.jsx
│   │   └── ChapterEditorPage.jsx
│   └── components/       # 通用组件
└── vite.config.js        # Vite配置
```

---

## 🔍 API接口文档

### 认证接口
```
POST /api/auth/login
Body: { "username": "test", "password": "123456" }
```

### 小说接口
```
GET    /api/novels              # 获取小说列表
POST   /api/novels              # 创建小说
GET    /api/novels/:id          # 获取小说详情
PUT    /api/novels/:id          # 更新小说
DELETE /api/novels/:id          # 删除小说
```

### 章节接口
```
GET    /api/novels/:id/chapters         # 获取章节列表
POST   /api/novels/:id/chapters         # 创建章节
PUT    /api/novels/:id/chapters/:chId   # 更新章节
DELETE /api/novels/:id/chapters/:chId   # 删除章节
```

### AI接口
```
POST /api/ai/generate
Body: {
  "outline": "剧情大纲",
  "wordCount": 2000,
  "characterCards": [...],
  "itemCards": [...],
  "sceneCards": [...]
}
```

### 卡片接口
```
GET    /api/cards              # 获取卡片列表
POST   /api/cards              # 创建卡片
PUT    /api/cards/:id          # 更新卡片
DELETE /api/cards/:id          # 删除卡片
```

---

## 💡 开发建议

### 1. 使用浏览器开发者工具
- `F12` 打开
- Console：查看JavaScript错误
- Network：监控API请求
- Application：查看LocalStorage（token）

### 2. 代码修改后
- **前端**：Vite会自动热重载，刷新页面即可
- **后端**：需要手动重启服务

### 3. 数据持久化
- 当前使用内存数据库，重启后数据会丢失
- 如需持久化，可以修改 `backend/database/memoryDB.js`

### 4. 测试AI功能
- 建议先用短大纲测试（减少API消耗）
- 字数选择500-1000字即可
- 检查生成速度和质量

---

## 🆘 常见问题

### Q1：前端显示"无法连接服务器"
**检查**：
1. 后端是否运行：`netstat -ano | Select-String ":5000"`
2. CORS配置是否正确
3. 浏览器控制台的Network错误

### Q2：AI生成一直loading
**原因**：
- Google API连接问题
- 网络超时
- 配额不足

**解决**：
1. 查看后端日志
2. 测试：`node backend/test-vertex-ai.js`
3. 检查Google Cloud配额

### Q3：修改代码不生效
**前端**：
- 清除浏览器缓存（Ctrl+Shift+R）
- 检查文件是否保存

**后端**：
- 重启服务
- 检查.env配置

### Q4：想修改端口
**前端**：修改 `frontend/vite.config.js` 中的 `server.port`
**后端**：修改 `backend/.env` 中的 `PORT`

---

## 🎯 快速命令

```powershell
# 查看运行中的服务
netstat -ano | Select-String ":(3000|5000)"

# 停止所有node进程
Stop-Process -Name node -Force

# 查看node进程
Get-Process node

# 测试API
Invoke-RestMethod -Uri "http://localhost:5000/api/novels" -Method Get -Headers @{"Authorization"="Bearer YOUR_TOKEN"}

# 查看端口占用
Get-NetTCPConnection -LocalPort 3000,5000
```

---

## 📌 提交代码前检查

- [ ] 测试所有主要功能
- [ ] 检查控制台无错误
- [ ] 清理调试代码（console.log）
- [ ] 更新文档
- [ ] 使用 `.\快速推送.bat` 提交

---

**开始调试吧！遇到问题随时查看这个文档！🚀**

