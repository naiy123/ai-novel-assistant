# 🚀 阿里云快速开始（3 步部署）

## ⚡ 超快速部署流程

### 准备工作（5 分钟）

1. **购买阿里云 ECS**
   - 访问：https://ecs-buy.aliyun.com/
   - 配置：2核4G，Ubuntu 22.04
   - 价格：约 ¥90/月

2. **购买 HTTP 代理**（必需）
   - 推荐：蘑菇代理 https://www.moguproxy.com/
   - 价格：约 ¥30-50/月
   - 获取代理地址：`http://用户名:密码@proxy.example.com:8080`

---

## 📋 部署步骤（10 分钟）

### 第 1 步：连接服务器

```bash
# 使用阿里云提供的公网 IP
ssh root@你的ECS公网IP
```

### 第 2 步：下载并运行部署脚本

```bash
# 克隆项目
cd /var/www
git clone https://github.com/naiy123/ai-novel-assistant.git
cd ai-novel-assistant

# 上传 Google Cloud 密钥
# 从本地上传（在本地终端运行）：
scp backend/credentials/google-cloud-key.json root@你的ECS公网IP:/var/www/ai-novel-assistant/backend/credentials/

# 运行自动部署脚本
chmod +x deploy-aliyun.sh
./deploy-aliyun.sh
```

### 第 3 步：按提示操作

脚本会自动：
- ✅ 安装 Docker 和 Docker Compose
- ✅ 检查项目文件
- ✅ 配置环境变量（会提示你输入）
- ✅ 构建前端
- ✅ 启动服务

**提示输入时**：
1. `Google Cloud Project ID`: 输入 `mindful-hall-474616-d5`
2. `HTTP 代理地址`: 输入你的代理地址（如 `http://user:pass@proxy.com:8080`）

---

## ✅ 部署完成！

脚本完成后，你会看到：

```
================================================
✅ 部署完成！
================================================

🌐 访问地址：
   前端：http://你的服务器IP
   后端：http://你的服务器IP:5000

📝 查看日志：
   docker-compose logs -f backend
```

---

## 🔧 常用命令

```bash
# 查看日志
docker-compose logs -f

# 重启服务
docker-compose restart

# 停止服务
docker-compose stop

# 启动服务
docker-compose up -d

# 更新代码
git pull && ./update.sh

# 备份数据
./backup.sh
```

---

## 🌐 绑定域名（可选）

### 1. 购买域名

访问：https://wanwang.aliyun.com/

### 2. 添加 DNS 记录

在域名控制台添加 A 记录：
```
类型：A
主机记录：@ 或 www
记录值：你的服务器公网IP
TTL：10分钟
```

### 3. ICP 备案

需要 7-20 天，备案完成后才能使用域名。

备案期间可以先用 IP 访问测试。

---

## 🐛 遇到问题？

### 问题 1：后端启动失败

```bash
# 查看详细日志
docker-compose logs backend

# 常见原因：
# 1. Google Cloud 密钥未上传
# 2. 代理配置错误
# 3. 环境变量配置错误
```

**解决**：
```bash
# 检查密钥文件
ls -la backend/credentials/

# 检查环境变量
cat backend/.env.production

# 重新启动
docker-compose restart
```

### 问题 2：AI 生成失败

```bash
# 测试代理
docker-compose exec backend curl -x $HTTP_PROXY https://www.google.com

# 如果失败，检查代理配置
```

### 问题 3：前端无法访问后端

```bash
# 检查 Nginx 配置
docker-compose logs nginx

# 检查端口
netstat -tulpn | grep 80
```

---

## 💰 成本总计

| 项目 | 费用 |
|------|------|
| ECS (2核4G) | ¥90-120/月 |
| HTTP 代理 | ¥30-50/月 |
| 域名（可选） | ¥50-100/年 |
| **总计** | **¥120-170/月** |

---

## 📞 技术支持

如遇问题，提供以下信息：

1. 服务器系统版本：`cat /etc/os-release`
2. Docker 版本：`docker --version`
3. 错误日志：`docker-compose logs backend`
4. 环境变量（脱敏）：`cat backend/.env.production`

---

## 🎉 恭喜！

你现在拥有了：
- ✅ 生产级 AI 小说写作平台
- ✅ 中国高速访问
- ✅ 可商业化的基础设施
- ✅ 自动化运维工具

**开始你的商业化之旅吧！** 🚀

