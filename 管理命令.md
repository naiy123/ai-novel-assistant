# 🛠️ 服务管理命令

## 📊 查看状态

```powershell
# 查看所有服务
pm2 status

# 查看详细信息
pm2 info ai-novel-backend
pm2 info ai-novel-frontend
```

---

## 📝 查看日志

```powershell
# 实时查看所有日志
pm2 logs

# 查看指定服务日志
pm2 logs ai-novel-backend
pm2 logs ai-novel-frontend

# 查看最近N行
pm2 logs --lines 50

# 只看错误日志
pm2 logs --err

# 清空日志
pm2 flush
```

---

## 🔄 重启服务

```powershell
# 重启所有
pm2 restart all

# 重启后端
pm2 restart ai-novel-backend

# 重启前端
pm2 restart ai-novel-frontend
```

---

## ⏹️ 停止服务 taskkill /F /IM node.exe

```powershell
# 停止所有
pm2 stop all

# 停止后端
pm2 stop ai-novel-backend

# 停止前端
pm2 stop ai-novel-frontend
```

---

## ▶️ 启动服务

```powershell
# 启动所有（从保存的列表）
pm2 resurrect

# 手动启动后端
cd backend
pm2 start server.js --name "ai-novel-backend"

# 手动启动前端
cd frontend
pm2 serve dist 80 --name "ai-novel-frontend" --spa
```

---

## 💾 保存配置

```powershell
# 保存当前进程列表
pm2 save

# 设置开机自启
pm2 startup
```

---

## 🗑️ 删除服务

```powershell
# 删除所有
pm2 delete all

# 删除指定服务
pm2 delete ai-novel-backend
pm2 delete ai-novel-frontend
```

---

## 📊 监控

```powershell
# 实时监控（CPU、内存）
pm2 monit

# 简单列表
pm2 list

# 查看进程详情
pm2 show ai-novel-backend
```

---

## 🔧 更新应用

### 更新后端
```powershell
cd backend
git pull
npm install
pm2 restart ai-novel-backend
```

### 更新前端
```powershell
cd frontend
git pull
npm install
npm run build
pm2 restart ai-novel-frontend
```

---

## 🆘 故障排查

### 服务无法启动
```powershell
# 查看错误日志
pm2 logs --err

# 删除并重新启动
pm2 delete all
# 然后重新启动服务
```

### 端口被占用
```powershell
# 查看端口占用
netstat -ano | Select-String ":80"
netstat -ano | Select-String ":5000"

# 杀死进程
Stop-Process -Id <PID> -Force
```

### 网站无法访问
1. 检查服务状态：`pm2 status`
2. 检查端口监听：`netstat -ano | Select-String ":80"`
3. 检查防火墙：阿里云安全组 + Windows防火墙
4. 查看日志：`pm2 logs --err`

---

## 📞 访问地址

- **前端**: http://118.170.194.12
- **后端**: http://118.170.194.12:5000
- **本地**: http://localhost

---

## 💡 常用组合命令

```powershell
# 完整重启流程
pm2 stop all
pm2 delete all
cd backend
pm2 start server.js --name "ai-novel-backend"
cd ../frontend
pm2 serve dist 80 --name "ai-novel-frontend" --spa
pm2 save

# 查看状态和日志
pm2 status && pm2 logs --lines 20

# 快速诊断
pm2 status
pm2 logs --err
netstat -ano | Select-String ":80"
```

---

**更多详情请查看**: [Windows部署说明.md](./Windows部署说明.md)
