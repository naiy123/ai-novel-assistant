# 🎛️ 宝塔面板部署指南（最简单）

## 📋 服务器信息（从截图）

```
服务器名称: 宝塔Linux面板-vyyg
IP地址: 8.130.74.146
配置: 2核 4GB 内存 50GB 磁盘
地域: 华北6（乌兰察布）
系统: 宝塔Linux面板 阿里云专享版 9.2.0
```

---

## 🚀 超简单部署流程（20 分钟）

### 准备工作

1. **宝塔面板地址**：`http://8.130.74.146:8888`
2. **宝塔账号密码**：在阿里云控制台查看（应用详情页）

---

## 📋 第 1 步：登录宝塔面板（2 分钟）

### 1.1 获取宝塔登录信息

在阿里云控制台：
1. 进入你的服务器详情页
2. 点击"应用详情"或"远程连接"
3. 查看宝塔面板的登录地址、用户名、密码

### 1.2 登录宝塔

访问：`http://8.130.74.146:8888`

输入用户名和密码登录。

---

## 📦 第 2 步：安装软件（5 分钟）

### 2.1 安装必要软件

在宝塔面板左侧菜单：

**软件商店** → 搜索并安装以下软件：

1. **Nginx** 1.22+（必需）
   - 点击"安装" → 选择"编译安装"或"极速安装"
   - 等待 2-3 分钟

2. **Node.js** 18.x（必需）
   - 搜索 "Node 版本管理器"
   - 安装后，安装 Node.js 18.x

3. **PM2** 管理器（推荐）
   - 搜索 "PM2 管理器"
   - 安装

4. **Redis**（可选，用于缓存）
   - 如需要可以安装

### 2.2 配置安全组

在阿里云控制台：
1. 服务器详情 → 安全组
2. 添加规则：
   ```
   端口: 5000（后端 API）
   协议: TCP
   授权对象: 0.0.0.0/0
   ```

---

## 📂 第 3 步：上传项目代码（5 分钟）

### 方法 A：使用宝塔文件管理器（推荐）

1. **宝塔面板** → **文件**
2. 进入 `/www/wwwroot/` 目录
3. 点击"远程下载"
4. 输入 GitHub 仓库地址：
   ```
   https://github.com/naiy123/ai-novel-assistant/archive/refs/heads/main.zip
   ```
5. 下载完成后，解压文件
6. 重命名为 `ai-novel-assistant`

### 方法 B：使用 Git（更专业）

1. **宝塔面板** → **终端**
2. 运行命令：
   ```bash
   cd /www/wwwroot/
   git clone https://github.com/naiy123/ai-novel-assistant.git
   ```

---

## 🔧 第 4 步：配置后端（5 分钟）

### 4.1 安装后端依赖

**宝塔终端** 或 **SSH 连接**：

```bash
cd /www/wwwroot/ai-novel-assistant/backend
npm install --production
```

### 4.2 创建环境变量文件

在宝塔**文件管理器**中：

1. 进入 `/www/wwwroot/ai-novel-assistant/backend/`
2. 创建新文件：`.env.production`
3. 编辑内容：

```env
# 服务器配置
PORT=5000
NODE_ENV=production

# JWT 密钥（点击宝塔终端运行：openssl rand -hex 32）
JWT_SECRET=你生成的随机密钥

# Google Cloud 配置
VERTEX_AI_PROJECT_ID=mindful-hall-474616-d5
VERTEX_AI_LOCATION=us-central1

# HTTP 代理（必需，访问 Google API）
HTTP_PROXY=http://你的代理地址:端口
HTTPS_PROXY=http://你的代理地址:端口

# 时区
TZ=Asia/Shanghai
```

**生成 JWT_SECRET**：
在宝塔终端运行：
```bash
openssl rand -hex 32
```
复制输出的字符串作为 JWT_SECRET。

### 4.3 上传 Google Cloud 密钥

1. 在宝塔文件管理器中创建目录：
   `/www/wwwroot/ai-novel-assistant/backend/credentials/`

2. 上传你的 `google-cloud-key.json` 文件到这个目录

---

## 🚀 第 5 步：启动后端服务（3 分钟）

### 使用 PM2 管理器（推荐）

1. **宝塔面板** → **软件商店** → **PM2 管理器** → **设置**

2. 点击"添加项目"：
   ```
   项目名称: ai-novel-backend
   运行目录: /www/wwwroot/ai-novel-assistant/backend
   启动文件: server.js
   环境变量: 点击"添加" → 从 .env.production 文件读取
   开机自启: 勾选
   ```

3. 点击"提交"

4. 启动状态会显示为"运行中"

### 或使用命令行

```bash
cd /www/wwwroot/ai-novel-assistant/backend
npm start
```

### 测试后端

在浏览器访问：
```
http://8.130.74.146:5000/
```

应该看到：
```json
{
  "message": "欢迎使用 AI 小说写作助手 API",
  "version": "1.0.0"
}
```

---

## 🎨 第 6 步：部署前端（5 分钟）

### 6.1 构建前端

在宝塔终端：

```bash
cd /www/wwwroot/ai-novel-assistant/frontend

# 配置生产环境 API 地址
echo "VITE_API_BASE_URL=http://8.130.74.146:5000" > .env.production

# 安装依赖
npm install

# 构建
npm run build
```

构建完成后，会生成 `dist` 目录。

### 6.2 配置 Nginx 站点

1. **宝塔面板** → **网站** → **添加站点**

2. 填写信息：
   ```
   域名: 8.130.74.146（先用 IP，后续可以绑定域名）
   根目录: /www/wwwroot/ai-novel-assistant/frontend/dist
   PHP版本: 纯静态
   ```

3. 点击"提交"

### 6.3 配置反向代理

1. 在网站列表找到刚创建的站点
2. 点击"设置" → "反向代理"
3. 添加反向代理：
   ```
   代理名称: 后端API
   目标URL: http://127.0.0.1:5000
   发送域名: $host
   ```
4. 保存

### 6.4 配置 URL 重写（支持前端路由）

1. 站点设置 → "配置文件"
2. 找到 `location / {` 部分
3. 修改为：
   ```nginx
   location / {
       root /www/wwwroot/ai-novel-assistant/frontend/dist;
       index index.html;
       try_files $uri $uri/ /index.html;
   }
   
   location /api {
       proxy_pass http://127.0.0.1:5000;
       proxy_set_header Host $host;
       proxy_set_header X-Real-IP $remote_addr;
       proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
       proxy_set_header X-Forwarded-Proto $scheme;
       
       # 超时设置（AI 生成需要时间）
       proxy_connect_timeout 300s;
       proxy_send_timeout 300s;
       proxy_read_timeout 300s;
   }
   ```
5. 保存并重启 Nginx

---

## ✅ 第 7 步：测试部署

### 7.1 测试前端

访问：`http://8.130.74.146/`

应该看到登录页面。

### 7.2 测试登录

```
用户名：test
密码：123456
```

### 7.3 测试 AI 功能

1. 登录后，创建小说
2. 打开章节编辑器
3. 点击"AI 写作"
4. 输入剧情大纲并生成

---

## 🌐 绑定域名（可选）

### 1. 在阿里云购买域名

访问：https://wanwang.aliyun.com/

### 2. 添加 DNS 解析

域名控制台 → DNS 解析：
```
记录类型: A
主机记录: @ 或 www
记录值: 8.130.74.146
TTL: 10分钟
```

### 3. 在宝塔修改站点

1. 网站 → 设置
2. 修改域名为你的域名
3. 保存

### 4. 申请 SSL 证书（HTTPS）

1. 网站 → SSL
2. 点击"Let's Encrypt"
3. 勾选域名
4. 申请证书
5. 部署

---

## 🔄 日常管理

### 查看后端日志

**宝塔面板** → **PM2 管理器** → 找到项目 → **日志**

### 重启后端

**PM2 管理器** → 项目操作 → **重启**

### 更新代码

**宝塔终端**：
```bash
cd /www/wwwroot/ai-novel-assistant
git pull

# 重新构建前端
cd frontend
npm run build

# 重启后端
pm2 restart ai-novel-backend
```

### 查看系统资源

**宝塔面板** → **首页** → 查看 CPU、内存、磁盘使用情况

### 备份数据

**宝塔面板** → **计划任务** → 添加备份任务：
```
任务类型: 备份网站
执行周期: 每天 2:00
备份目录: /www/wwwroot/ai-novel-assistant
```

---

## 🔒 安全设置

### 1. 修改宝塔面板端口

**宝塔设置** → **面板设置** → **面板端口**
- 建议改为非常规端口（如 18888）

### 2. 启用宝塔 WAF

**软件商店** → 搜索"Nginx防火墙" → 安装

### 3. 配置 IP 白名单

**安全** → **面板防火墙** → 添加允许访问的 IP

### 4. 定期更新

定期更新宝塔面板和所有软件到最新版本。

---

## 📊 监控和优化

### 1. 安装监控插件

**软件商店** → 搜索"宝塔监控" → 安装

### 2. 查看网站流量

**网站** → 站点设置 → **流量限制**

### 3. 启用缓存

**网站** → 站点设置 → **性能优化** → 启用 Gzip 压缩

---

## 🐛 常见问题

### Q1: 后端启动失败

**解决**：
1. 查看 PM2 日志
2. 检查 `.env.production` 文件
3. 检查 Google Cloud 密钥文件
4. 检查端口 5000 是否被占用

### Q2: 前端无法访问后端

**解决**：
1. 检查 Nginx 反向代理配置
2. 检查安全组规则
3. 测试后端是否运行：`curl http://127.0.0.1:5000/`

### Q3: AI 生成失败

**解决**：
1. 检查代理配置
2. 测试代理：在宝塔终端运行
   ```bash
   curl -x $HTTP_PROXY https://www.google.com
   ```
3. 查看后端日志

### Q4: 内存不足

**解决**：
1. 宝塔面板 → 软件商店 → 安装"堡塔应用管理器"
2. 优化 Node.js 内存：
   ```bash
   # 在 PM2 启动选项添加
   --max-old-space-size=2048
   ```

---

## 💰 成本说明

```
阿里云轻量服务器（2核4G）: ¥90-120/月
HTTP 代理（访问 Google）: ¥30-50/月
域名（可选）: ¥50-100/年
总计: ¥120-170/月
```

---

## 📞 技术支持

### 宝塔相关

- 官方论坛：https://www.bt.cn/bbs/
- 官方文档：https://www.bt.cn/docs/

### 项目相关

查看项目文档：
- `阿里云快速开始.md`
- `阿里云部署指南.md`
- `使用指南.md`

---

## 🎉 完成！

现在你的 AI 小说写作平台已经部署完成！

访问：`http://8.130.74.146/`

登录测试账号：
```
用户名：test
密码：123456
```

---

## 📋 检查清单

部署完成后，确认：

- [ ] 宝塔面板可以访问
- [ ] Node.js 已安装
- [ ] Nginx 已安装
- [ ] 项目代码已上传
- [ ] 后端依赖已安装
- [ ] 环境变量已配置
- [ ] Google Cloud 密钥已上传
- [ ] 后端服务运行中（PM2）
- [ ] 前端已构建
- [ ] Nginx 站点已创建
- [ ] 反向代理已配置
- [ ] 前端可以访问
- [ ] 后端 API 可以访问
- [ ] 登录功能正常
- [ ] AI 生成功能正常

---

**宝塔面板让部署变得超级简单！祝使用愉快！** 🎉

